/*
Strada 0.9.1
Copyright Â© 2020 Basecamp, LLC
*/
(()=>{var i=class{constructor(){this.adapter=null,this.lastMessageId=0,this.pendingMessages=[],this.pendingCallbacks=new Map}start(){this.notifyApplicationAfterStart()}notifyApplicationAfterStart(){document.dispatchEvent(new Event("web-bridge:ready"))}supportsComponent(e){return this.adapter?this.adapter.supportsComponent(e):!1}send({component:e,event:s,data:n,callback:t}){if(!this.adapter)return this.savePendingMessage({component:e,event:s,data:n,callback:t}),null;if(!this.supportsComponent(e))return null;let a=this.generateMessageId(),g={id:a,component:e,event:s,data:n||{}};return this.adapter.receive(g),t&&this.pendingCallbacks.set(a,t),a}receive(e){this.executeCallbackFor(e)}executeCallbackFor(e){let s=this.pendingCallbacks.get(e.id);s&&s(e)}removeCallbackFor(e){this.pendingCallbacks.has(e)&&this.pendingCallbacks.delete(e)}removePendingMessagesFor(e){this.pendingMessages=this.pendingMessages.filter(s=>s.component!=e)}generateMessageId(){let e=++this.lastMessageId;return e.toString()}setAdapter(e){this.adapter=e,document.documentElement.dataset.bridgePlatform=this.adapter.platform,this.adapterDidUpdateSupportedComponents(),this.sendPendingMessages()}adapterDidUpdateSupportedComponents(){this.adapter&&(document.documentElement.dataset.bridgeComponents=this.adapter.supportedComponents.join(" "))}savePendingMessage(e){this.pendingMessages.push(e)}sendPendingMessages(){this.pendingMessages.forEach(e=>this.send(e)),this.pendingMessages=[]}},r=i,d=new r;window.webBridge=d;d.start();})();
